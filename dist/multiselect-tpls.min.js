angular.module("oi.multiselect",["template/multiselect/template.html"]),angular.module("template/multiselect/template.html",[]).run(["$templateCache",function(a){a.put("template/multiselect/template.html",'<div class="multiselect-search" ng-class="{open: isOpen, focused: isFocused}" ng-click="setFocus($event)">\n    <ul class="multiselect-search-list">\n        <li class="btn btn-default btn-xs multiselect-search-list-item multiselect-search-list-item_selection"\n            ng-repeat="item in output track by $index"\n            ng-class="{focused: backspaceFocus && $last}"\n            ng-click="removeItem($index)">{{getLabel(item)}}<span class="close multiselect-search-list-item_selection-remove">Ã—</span></li>\n        <li class="multiselect-search-list-item multiselect-search-list-item_input"><input autocomplete="off"\n                                                                                           ng-model="query"\n                                                                                           ng-style="{\'width\': inputWidth + \'px\'}"\n                                                                                           ng-keydown="keyParser($event)"/></li>\n        <li class="multiselect-search-list-item multiselect-search-list-item_loader" ng-show="showLoader"></li>\n    </ul>\n</div>\n<div class="multiselect-dropdown" ng-show="isOpen" ng-click="setFocus($event)">\n    <ul ng-if="isOpen" class="multiselect-dropdown-optgroup" ng-repeat="(group, options) in groups">\n        <div class="multiselect-dropdown-optgroup-header"\n            ng-if="group && options.length"\n            ng-bind="group"></div><!-- we use fast getElementsByTagName(\'li\')-->\n        <li class="multiselect-dropdown-optgroup-option"\n            ng-repeat="option in options"\n            ng-class="{\'active\': selectorPosition === groupPos[group] + $index}"\n            ng-click="addItem(option)"\n            ng-mouseenter="setSelection(groupPos[group] + $index)"\n            ng-bind-html="\'{{getLabel(option)}}\' | multiselectHighlight: oldQuery || query"></li>\n    </ul>\n</div>')}]),angular.module("oi.multiselect").factory("miltiselectUtils",["$document",function(a){function b(b,d){var e=angular.element("<mirror>").css({position:"absolute",width:"auto",padding:0,whiteSpace:"pre",visibility:"hidden","z-index":-99999}).text(b||"");c(d,e,"letterSpacing fontSize fontFamily fontWeight textTransform".split(" ")),a[0].body.appendChild(e[0]);var f=e[0].offsetWidth;return e.remove(),f}function c(a,b,c){for(var d={},e=getComputedStyle(a[0],""),f=0,g=c.length;g>f;f++)d[c[f]]=e[c[f]];b.css(d)}function d(a,b){var c,d,e,g,i,j;b&&(d=a.offsetHeight,e=h(b,"height","margin"),g=a.scrollTop||0,c=f(b).top-f(a).top+g,i=c,j=c-d+e,c+e>d+g?a.scrollTop=j:g>c&&(a.scrollTop=i))}function e(a,b,c,d,e){function f(a){return parseFloat(e[a])}for(var g=c===(d?"border":"content")?4:"width"===b?1:0,h=0,i=["Top","Right","Bottom","Left"];4>g;g+=2)"margin"===c&&(h+=f(c+i[g])),d?("content"===c&&(h-=f("padding"+i[g])),"margin"!==c&&(h-=f("border"+i[g]+"Width"))):(h+=f("padding"+i[g]),"padding"!==c&&(h+=f("border"+i[g]+"Width")));return h}function f(a){var b,c,d=a.getBoundingClientRect(),e=a&&a.ownerDocument;if(e)return b=e.documentElement,c=g(e),{top:d.top+c.pageYOffset-b.clientTop,left:d.left+c.pageXOffset-b.clientLeft}}function g(a){return null!=a&&a===a.window?a:9===a.nodeType&&a.defaultView}function h(a,b,c){var d=!0,f="width"===b?a.offsetWidth:a.offsetHeight,g=window.getComputedStyle(a,null),h=!1;if(0>=f||null==f){if(f=g[b],(0>f||null==f)&&(f=a.style[b]),m.test(f))return f;f=parseFloat(f)||0}return f+e(a,b,c||(h?"border":"content"),d,g)}function i(a,b){b.css("width",h(a[0],"width","margin")+"px")}function j(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b].length)return!1;return!0}function k(a){var b=[];return angular.forEach(a,function(a){b.push(a)}),b}var l=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,m=new RegExp("^("+l+")(?!px)[a-z%]+$","i");return{copyWidth:i,measureString:b,scrollActiveOption:d,groupsIsEmpty:j,objToArr:k}}]),angular.module("oi.multiselect").directive("oiMultiselect",["$document","$q","$timeout","$parse","$interpolate","miltiselectUtils",function(a,b,c,d,e,f){var g=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,h=/([^\(\)\s\|\s]*)\s*(\(.*\))?\s*(\|?\s*.+)?/;return{restrict:"AE",templateUrl:"template/multiselect/template.html",require:"ngModel",scope:{},compile:function(i,j){var k,l=j.ngOptions;if(!(k=l.match(g)))throw new Error("Expected expression in form of '_select_ (as _label_)? for (_key_,)?_value_ in _collection_'");var m,n=k[2]||k[1],o=k[4]||k[6],p=k[3]||"",q=k[8]||n,r=k[7].match(h),s=r[1],t=s+(r[3]||""),u=s+(r[2]||""),v=d(n),w=d(p),x=d(t),y=d(u),z=d(q),A={},B=Number(j.asyncTimeout)||100,C=angular.isDefined(j.multiple),D=angular.isDefined(j.notempty),E=Number(j.multipleLimit),F=e(j.placeholder||""),G=!1,H=!1;return function(d,e,g,h){function i(b){b.target.ownerDocument.activeElement!==L[0]&&(t(),a.off("click",i),d.isFocused=!1,d.$digest())}function j(){var a=h.$modelValue&&h.$modelValue.length?"":N;L.attr("placeholder",a),d.inputWidth=f.measureString(d.query||a,L)+4}function k(a){return A={},A[o]=a,z(d,A)}function l(a){return A={},s.split(".").reduce(function(b,c,d,e){return b[c]=d<e.length-1?{}:a},A),x(d.$parent,A)}function n(a){return A={},A[o]=a,v(d,A)}function p(a){return A={},A[o]=a,w(d,A)||""}function q(a){var e=y(d.$parent,{$query:a}),f=0;d.selectorPosition=0,a||(d.oldQuery=null),m&&angular.isFunction(e.then)&&(c.cancel(m),f=B),m=c(function(){d.showLoader=!0,b.when(e).then(function(b){d.groups=I(l(J(b,a))),r()}).finally(function(){d.showLoader=!1})},f)}function r(){var a,b,c,e=[],f=0;d.order=[],d.groupPos={};for(b in d.groups)d.groups.hasOwnProperty(b)&&"$"!=b.charAt(0)&&e.push(b);for(e.sort(),a=0;a<e.length;a++)b=e[a],c=d.groups[b],d.order=d.order.concat(c),d.groupPos[b]=f,f+=c.length}function t(){d.oldQuery=null,d.backspaceFocus=!1,d.query="",d.groups={},d.order=[],d.showLoader=!1,d.isOpen=!1,m&&c.cancel(m)}function u(a,b){d.selectorPosition=b,f.scrollActiveOption(a[0],a.find("li")[b])}function I(a){for(var b,c,d={"":[]},e=0;e<a.length;e++)b=p(a[e]),(c=d[b])||(c=d[b]=[]),c.push(a[e]);return d}function J(a,b){var c,d,e=[],g=[],h=[],i=angular.isArray(a)?a:f.objToArr(a);if(b){for(c=0;c<i.length;c++)n(i[c]).match(new RegExp(b,"i"))&&e.push(i[c]);for(c=0;c<e.length;c++)n(e[c]).match(new RegExp("^"+b,"i"))?g.push(e[c]):h.push(e[c]);d=g.concat(h)}else d=[].concat(i);return K(d),d}function K(a){var b,c,e=[].concat(d.output);for(b=0;b<a.length;b++)for(c=0;c<e.length;c++)if(k(a[b])===k(e[c])){a.splice(b,1),e.splice(c,1),b--;break}}var L=e.find("input"),M=angular.element(e[0].querySelector(".multiselect-dropdown")),N=F(d);angular.isDefined(g.readonly)&&L.attr("readonly",!0),g.$observe("disabled",function(a){L.prop("disabled",a)}),d.$parent.$watch(g.ngModel,function(a){j(),d.output=C?a:a?[a]:[]}),d.$watch("query",function(a,b){j(),a===b||d.oldQuery&&!a||H||(M[0].scrollTop=0,a?(q(a),d.oldQuery=null):(t(),H=!0)),H=!1}),d.$watch("groups",function(b){f.groupsIsEmpty(b)?d.isOpen=!1:d.isOpen||g.disabled||(d.isOpen=!0,f.copyWidth(e,M),d.isFocused||(a.on("click",i),d.isFocused=!0))}),d.setFocus=function(a){g.disabled||(angular.element(a.target).scope()===this&&(d.isOpen?t():q(d.query)),d.backspaceFocus=!1,"INPUT"!==a.target.nodeName&&L[0].focus())},d.addItem=function(a){if(isNaN(E)||!(d.output.length>=E)){var b=d.groups[p(a)];b.splice(b.indexOf(a),1),C?(h.$setViewValue(angular.isArray(h.$modelValue)?h.$modelValue.concat(a):[a]),r()):(h.$setViewValue(a),t()),f.groupsIsEmpty(d.groups)&&(d.groups={}),d.oldQuery=d.oldQuery||d.query,d.query="",d.backspaceFocus=!1,j()}},d.removeItem=function(a){g.disabled||(C?(h.$modelValue.splice(a,1),h.$setViewValue([].concat(h.$modelValue))):D||h.$setViewValue(void 0),d.query="",(d.isOpen||d.oldQuery||!C)&&q(d.oldQuery),j())},d.setSelection=function(a){G||d.selectorPosition===a?G=!1:u(M,a)},d.keyParser=function(a){var b=0,c=d.order.length-1;switch(a.keyCode){case 38:u(M,d.selectorPosition===b?c:d.selectorPosition-1),G=!0;break;case 40:u(M,d.selectorPosition===c?b:d.selectorPosition+1),G=!0,d.query.length||d.isOpen||q();break;case 37:case 39:break;case 13:f.groupsIsEmpty(d.groups)||(d.addItem(d.order[d.selectorPosition]),d.selectorPosition===c&&u(M,0));break;case 27:t();break;case 8:if(!d.query.length){if(d.backspaceFocus&&d.output&&(d.removeItem(d.output.length-1),!d.output.length)){q();break}d.backspaceFocus=!d.backspaceFocus;break}default:return d.backspaceFocus=!1,!1}},d.getLabel=n,C&&(h.$isEmpty=function(a){return!a||!a.length}),t()}}}}]),angular.module("oi.multiselect").filter("multiselectHighlight",["$sce",function(a){return function(b,c){var d;return c.length>0||angular.isNumber(c)?(b=b.toString(),c=c.toString(),d=b.replace(new RegExp(c,"gi"),"<strong>$&</strong>")):d=b,a.trustAsHtml(d)}}]);